---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// 1. Hizmetleri Çek
const tumHizmetler = await getCollection('hizmetler');
tumHizmetler.sort((a, b) => a.data.order - b.data.order);

// 2. Slider Verisini Çek ve Sırala
const sliderVerileri = await getCollection('slider');
sliderVerileri.sort((a, b) => a.data.sira - b.data.sira);
---

<Layout title="Anasayfa" description="İstanbul ve çevre illerde su sondajı, kuyu temizliği ve ruhsat hizmetleri. 7/24 Teknik Servis.">

    <section id="anasayfa" class="hero-slider">
        
        <button class="hero-arrow hero-prev" id="heroPrevBtn"><i class="fas fa-chevron-left"></i></button>
        <button class="hero-arrow hero-next" id="heroNextBtn"><i class="fas fa-chevron-right"></i></button>

        {sliderVerileri.length === 0 && (
            <div class="slide active" style="background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1590247813693-5541d1c609fd?q=80&w=1920&auto=format&fit=crop');">
                <div class="hero-content">
                    <h1>Profesyonel Su Sondaj Hizmetleri</h1>
                    <p>En son teknoloji makinelerimizle su ihtiyacınızı karşılıyoruz.</p>
                    <div class="hero-cta-buttons">
                        <a href="tel:+905325406829" class="btn btn-primary"><i class="fas fa-phone"></i> HEMEN ARA</a>
                        <a href="https://wa.me/905325406829" class="btn btn-whatsapp"><i class="fab fa-whatsapp"></i> WHATSAPP</a>
                    </div>
                </div>
            </div>
        )}

        {sliderVerileri.map((slide, index) => (
            <div class={`slide ${index === 0 ? 'active' : ''}`} style={`background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('${slide.data.resim}');`}>
                <div class="hero-content">
                    <h1>{slide.data.title}</h1>
                    <p>{slide.data.aciklama}</p>
                    <div class="hero-cta-buttons">
                        <a href="tel:+905325406829" class="btn btn-primary"><i class="fas fa-phone"></i> HEMEN ARA</a>
                        <a href="https://wa.me/905325406829" class="btn btn-whatsapp"><i class="fab fa-whatsapp"></i> WHATSAPP</a>
                    </div>
                </div>
            </div>
        ))}

    </section>
    <section id="hakkimizda" class="about-intro-section">
        <div class="container">
            <div class="about-intro-grid">
                <div class="about-large-img">
                    <div class="experience-badge">20+ Yıllık Tecrübe</div>
                    <img src="https://www.uzaysondaj.com/templates/yootheme/cache/64/uzay-sondaj-su-kuyusu-6411b967.webp" alt="Profesyonel Sondaj Makinesi">
                </div>
                <div class="about-text-content">
                    <h2>Güvenilir Çözüm Ortağınız</h2>
                    <p class="lead-text">Safa Dalgıç Pompa olarak, suyun olduğu her yerde yanınızdayız. Kaliteli ekipman ve uzman kadromuzla hizmet veriyoruz.</p>
                    <p>Marmara bölgesinin zorlu zemin koşullarında edindiğimiz tecrübe ile su sondajı, kuyu temizliği ve pompa kurulumunda en yüksek verimi garanti ediyoruz. İş güvenliği standartlarına uygun, modern makine parkurumuzla projelerinizi zamanında teslim ediyoruz.</p>
                    
                    <div class="about-work-gallery">
                        <img src="https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=300&h=200&fit=crop" alt="Saha Çalışması">
                        <img src="https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=300&h=200&fit=crop" alt="Pompa Kurulumu">
                        <img src="https://images.unsplash.com/photo-1535198255921-274640984859?w=300&h=200&fit=crop" alt="Kuyu Açma">
                        <img src="https://images.unsplash.com/photo-1621905252507-b35492cc74b4?w=300&h=200&fit=crop" alt="Teknik Ekip">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="hizmetler" class="services">
        <div class="container">
            <h2 class="section-title">Hizmetlerimiz</h2>
            <p class="section-subtitle">Sondaj, kuyu ve pompa sistemlerinde anahtar teslim çözümler.</p>
            
            <div class="service-grid">
                {tumHizmetler.map((hizmet) => (
                    <div class="service-card">
                        <img src={hizmet.data.image} alt={hizmet.data.title} style="height: 250px; object-fit: cover;">
                        <div class="service-content">
                            <h3>{hizmet.data.title}</h3>
                            <p>{hizmet.data.description}</p>
                            <a href={`/hizmetler/${hizmet.slug}`} style="color: #004494; font-weight: bold; margin-top: 10px; display: inline-block;">
                                İncele <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </section>

    <section id="iletisim-formu" class="contact-form-section">
        <div class="container">
            <div class="form-wrapper">
                <div class="form-info">
                    <span class="sub-title">BİZE ULAŞIN</span>
                    <h3>Projeleriniz İçin<br>Çözüm Üretelim</h3>
                    <p>Sorularınız, keşif talepleriniz veya fiyat teklifi almak için formu doldurun veya aşağıdaki kanallardan bize hemen ulaşın.</p>
                    
                    <div class="contact-details">
                        <div class="contact-item-box">
                            <div class="icon-circle"><i class="fas fa-phone"></i></div>
                            <div class="contact-text">
                                <span>Bizi Arayın</span>
                                <strong>0532 540 68 29</strong>
                            </div>
                        </div>
                        <div class="contact-item-box">
                            <div class="icon-circle"><i class="fas fa-envelope"></i></div>
                            <div class="contact-text">
                                <span>E-Posta Gönderin</span>
                                <strong>info@safadalgicpompa.com</strong>
                            </div>
                        </div>
                        <div class="contact-item-box">
                            <div class="icon-circle"><i class="fas fa-map-marker-alt"></i></div>
                            <div class="contact-text">
                                <span>Ofis Adresimiz</span>
                                <strong>Yenişehir Mh. Osmanlı Bulvarı<br>Ayport Residence Pendik / İst.</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-box">
                    <form>
                        <div class="form-group">
                            <input type="text" placeholder="Adınız Soyadınız" required>
                        </div>
                        <div class="form-group">
                            <input type="tel" placeholder="Telefon Numaranız" required>
                        </div>
                        <div class="form-group">
                            <select>
                                <option value="">Hizmet Seçiniz</option>
                                <option value="sondaj">Su Sondajı</option>
                                <option value="pompa">Dalgıç Pompa</option>
                                <option value="bakim">Kuyu Bakımı</option>
                                <option value="ruhsat">Ruhsat İşlemleri</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <textarea placeholder="Mesajınız" rows="4"></textarea>
                        </div>
                        <button type="submit" class="btn-submit">GÖNDER</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

<script>
    // Sayfa her yüklendiğinde veya değiştiğinde (View Transitions uyumlu) çalıştır
    document.addEventListener('astro:page-load', () => {
        
        console.log("Slider Scripti Başlatılıyor..."); // Kontrol amaçlı log

        const slides = document.querySelectorAll('.hero-slider .slide');
        const prevBtn = document.getElementById('heroPrevBtn');
        const nextBtn = document.getElementById('heroNextBtn');
        let currentSlide = 0;

        // Slider yoksa dur
        if (slides.length === 0) {
            console.log("Slider elemanları bulunamadı.");
            return;
        }

        console.log("Slider bulundu, toplam slayt:", slides.length);

        function showSlide(index) {
            // Aktif slayttan active sınıfını kaldır
            slides[currentSlide].classList.remove('active');

            // İndeks hesapla
            currentSlide = (index + slides.length) % slides.length;

            // Yeni slayta active ekle
            slides[currentSlide].classList.add('active');
        }

        // Buton Tıklamaları
        if (nextBtn) {
            nextBtn.addEventListener('click', (e) => {
                e.preventDefault(); // Sayfanın zıplamasını engelle
                showSlide(currentSlide + 1);
            });
        }

        if (prevBtn) {
            prevBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showSlide(currentSlide - 1);
            });
        }

        // Otomatik Geçiş (5 saniye)
        if (slides.length > 1) {
            setInterval(() => {
                showSlide(currentSlide + 1);
            }, 5000);
        }
    });
</script>

</Layout>
