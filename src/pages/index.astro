---
export const prerender = true;
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// 1. Hizmetleri Çek
const tumHizmetler = await getCollection('hizmetler');
tumHizmetler.sort((a, b) => a.data.order - b.data.order);

// 2. Slider Verisini Çek ve Sırala
const sliderVerileri = await getCollection('slider');
sliderVerileri.sort((a, b) => a.data.sira - b.data.sira);

// Yorumları Çek
let yorumlar = [];
try {
  yorumlar = await getCollection('yorumlar');
} catch (e) { console.log("Yorum yok"); }

// Blogları Çek ve Tarihe Göre Sırala
let blogYazilari = [];
try {
  blogYazilari = await getCollection('blog');
  blogYazilari.sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf());
} catch (e) { console.log("Blog yok"); }

// Anasayfa için sadece son 3 tanesini al
const sonYorumlar = yorumlar.slice(0, 3);
const sonBloglar = blogYazilari.slice(0, 3);
---

<Layout title="Anasayfa" description="İstanbul ve çevre illerde su sondajı, kuyu temizliği ve ruhsat hizmetleri. 7/24 Teknik Servis.">

    <section id="anasayfa" class="hero-slider">
        
        <button class="hero-arrow hero-prev" id="heroPrevBtn"><i class="fas fa-chevron-left"></i></button>
        <button class="hero-arrow hero-next" id="heroNextBtn"><i class="fas fa-chevron-right"></i></button>

        {sliderVerileri.length === 0 && (
            <div class="slide active" style="background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1590247813693-5541d1c609fd?q=80&w=1920&auto=format&fit=crop');">
                <div class="hero-content">
                    <h1>Profesyonel Su Sondaj Hizmetleri</h1>
                    <p>En son teknoloji makinelerimizle su ihtiyacınızı karşılıyoruz.</p>
                </div>
            </div>
        )}

        {sliderVerileri.map((slide, index) => (
            <div class={`slide ${index === 0 ? 'active' : ''}`} style={`background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('${slide.data.resim}');`}>
                <div class="hero-content">
                    <h1>{slide.data.title}</h1>
                    <p>{slide.data.aciklama}</p>
                </div>
            </div>
        ))}

    </section>
    <section id="hakkimizda" class="about-intro-section">
        <div class="container">
            <div class="about-intro-grid">
                <div class="about-large-img">
                    <div class="experience-badge">20+ Yıllık Tecrübe</div>
                    <img src="/images/genel/safa-sondaj-anasayfa.webp" alt="Profesyonel Sondaj Makinesi">
                </div>
                <div class="about-text-content">
                    <h2>Güvenilir Çözüm Ortağınız</h2>
                    <p class="lead-text">Safa Dalgıç Pompa olarak, suyun olduğu her yerde yanınızdayız. Kaliteli ekipman ve uzman kadromuzla hizmet veriyoruz.</p>
                    <p>Marmara bölgesinin zorlu zemin koşullarında edindiğimiz tecrübe ile su sondajı, kuyu temizliği ve pompa kurulumunda en yüksek verimi garanti ediyoruz. İş güvenliği standartlarına uygun, modern makine parkurumuzla projelerinizi zamanında teslim ediyoruz.</p>
                    
                    <div class="about-work-gallery">
                        <img src="/images/genel/safa-sondaj-anasayfa.webp" alt="Saha Çalışması">
                        <img src="/images/genel/anasayfa1.webp" alt="Pompa Kurulumu">
                        <img src="/images/genel/anasayfa2.webp" alt="Kuyu Açma">
                        <img src="/images/genel/anasayfa3.webp" alt="Teknik Ekip">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="hizmetler" class="services">
        <div class="container">
            <h2 class="section-title">Hizmetlerimiz</h2>
            <p class="section-subtitle">Sondaj, kuyu ve pompa sistemlerinde anahtar teslim çözümler.</p>
            
            <div class="service-grid">
                {tumHizmetler.map((hizmet) => (
                    <div class="service-card">
                        <a href={`/hizmetler/${hizmet.slug}`}><img src={hizmet.data.image} alt={hizmet.data.title} style="height: 250px; object-fit: cover;"></a>
                        <div class="service-content">
                            <h3><a href={`/hizmetler/${hizmet.slug}`}>{hizmet.data.title}</h3></a>
                            <p>{hizmet.data.description}</p>
                            <a href={`/hizmetler/${hizmet.slug}`} style="color: #004494; font-weight: bold; margin-top: 10px; display: inline-block;">
                                İncele <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </section>


    <section id="referanslar" class="testimonials-section" style="background-color: #f8f9fa; padding: 60px 0;">
        <div class="container">
            <h2 class="section-title">Müşteri Yorumları</h2>
            <p class="section-subtitle">Bizi tercih eden müşterilerimizin düşünceleri.</p>

            <div class="testimonial-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 40px;">
                {sonYorumlar.length > 0 ? (
                    sonYorumlar.map((yorum) => (
                        <div class="testimonial-card" style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                            <div class="stars" style="color: #f39c12; margin-bottom: 15px;">
                                {Array.from({ length: yorum.data.puan }).map(() => (
                                    <i class="fas fa-star"></i>
                                ))}
                            </div>
                            <p style="font-style: italic; color: #555;">"{yorum.data.yorum}"</p>
                            <h4 style="color: #004494; margin-top: 15px;">{yorum.data.isim}</h4>
                            <span style="color: #888; font-size: 0.9em;">{yorum.data.unvan || 'Müşteri'}</span>
                        </div>
                    ))
                ) : (
                    <p style="text-align: center; width: 100%; color: #888;">Henüz yorum eklenmemiş.</p>
                )}
            </div>
        </div>
    </section>

   <section id="blog" class="blog-section" style="padding: 60px 0;">
        <div class="container">
            <h2 class="section-title">Blog & Duyurular</h2>
            <p class="section-subtitle">Sektörden güncel bilgiler.</p>

            <div class="blog-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 40px;">
                {sonBloglar.length > 0 ? (
                    sonBloglar.map((yazi) => (
                        <article class="blog-card" style="border: 1px solid #eee; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column;">
                            <a href={`/blog/${yazi.slug}`}><img src={yazi.data.image} alt={yazi.data.title} style="width: 100%; height: 200px; object-fit: cover;"></a>
                            
                            <div class="blog-content" style="padding: 20px; flex-grow: 1; display: flex; flex-direction: column;">
                                <span style="font-size: 0.85em; color: #888; margin-bottom: 5px;">
                                    {new Date(yazi.data.date).toLocaleDateString('tr-TR')}
                                </span>
                                
                                <h3 style="margin: 5px 0 10px 0; font-size: 1.2em; color: #333;">   <a href={`/blog/${yazi.slug}`}>{yazi.data.title}</a></h3>
                                
                                <p style="font-size: 0.95em; color: #666; line-height: 1.5; margin-bottom: 15px; flex-grow: 1;">
                                    {yazi.data.description ? yazi.data.description : 'İçerik detayları için tıklayınız...'}
                                </p>

                                <a href={`/blog/${yazi.slug}`} style="color: #004494; font-weight: bold; text-decoration: none; margin-top: auto;">
                                    Devamını Oku <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </article>
                    ))
                ) : (
                    <p style="text-align: center; width: 100%; color: #888;">Henüz blog yazısı eklenmemiş.</p>
                )}
            </div>
        </div>
    </section>

    <section id="iletisim-formu" class="contact-form-section">
        <div class="container">
            <div class="form-wrapper">
                <div class="form-info">
                    <span class="sub-title">BİZE ULAŞIN</span>
                    <h3>Projeleriniz İçin<br>Çözüm Üretelim</h3>
                    <p>Sorularınız, keşif talepleriniz veya fiyat teklifi almak için formu doldurun veya aşağıdaki kanallardan bize hemen ulaşın.</p>
                    
                    <div class="contact-details">
                        <div class="contact-item-box">
                            <div class="icon-circle"><i class="fas fa-phone"></i></div>
                            <div class="contact-text">
                                <span>Bizi Arayın</span>
                                <strong>0532 540 68 29</strong>
                            </div>
                        </div>
                        <div class="contact-item-box">
                            <div class="icon-circle"><i class="fas fa-envelope"></i></div>
                            <div class="contact-text">
                                <span>E-Posta Gönderin</span>
                                <strong>info@safadalgicpompa.com</strong>
                            </div>
                        </div>
                        <div class="contact-item-box">
                            <div class="icon-circle"><i class="fas fa-map-marker-alt"></i></div>
                            <div class="contact-text">
                                <span>Ofis Adresimiz</span>
                                <strong>Yenişehir Mh. Osmanlı Bulvarı<br>Ayport Residence Pendik / İst.</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-box">
                    <form>
                        <div class="form-group">
                            <input type="text" placeholder="Adınız Soyadınız" required>
                        </div>
                        <div class="form-group">
                            <input type="tel" placeholder="Telefon Numaranız" required>
                        </div>
                        <div class="form-group">
                            <textarea placeholder="Mesajınız" rows="4"></textarea>
                        </div>
                        <button type="submit" class="btn-submit">GÖNDER</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

</Layout>

